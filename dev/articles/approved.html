<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Logging Unapproved Package and Function Use • logrx</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Logging Unapproved Package and Function Use">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">logrx</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/logrx.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Use Cases</h6></li>
    <li><a class="dropdown-item" href="../articles/execution.html">Generating a Log</a></li>
    <li><a class="dropdown-item" href="../articles/generate-lockfile.html">Generate renv lockfile from log file</a></li>
    <li><a class="dropdown-item" href="../articles/tables.html">Logging for Summary Display Table</a></li>
    <li><a class="dropdown-item" href="../articles/adsl_demo.html">Logging for an ADSL dataset</a></li>
    <li><a class="dropdown-item" href="../articles/tidylog.html">Logging with {tidylog}</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Helpers</h6></li>
    <li><a class="dropdown-item" href="../articles/options.html">logrx Options</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/approved.html">Logging Unapproved Package and Function Use</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.slack.com" aria-label="slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/logrx/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Logging Unapproved Package and Function Use</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/logrx/blob/main/vignettes/approved.Rmd" class="external-link"><code>vignettes/approved.Rmd</code></a></small>
      <div class="d-none name"><code>approved.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="why-would-i-use-this-feature">Why would I use this feature?<a class="anchor" aria-label="anchor" href="#why-would-i-use-this-feature"></a>
</h2>
<p>The main use case of this feature is to support traceability of
package and function use within a validated environment.</p>
<p>Following the guidance outlined in <a href="https://www.pharmar.org/white-paper/" class="external-link">A Risk-Based Approach for
Assessing R Package Accuracy within a Validated Infrastructure</a>,
packages are selected to support use cases, risk is assessed and
mitigated, and packages are included in your validated environment for
use. <strong>Section 4.3</strong> of this paper nicely outlines the need
to trace what is used and the need to identify package and function use
where risk was not assessed for direct use within the validated
environment.</p>
<p><br></p>
<blockquote>
<p><em>4.3. Traceability</em></p>
<em>“One of the core concepts presented <a href="https://www.pharmar.org/white-paper/" class="external-link">in this paper</a> is that
Imports are not typically loaded by users and need not therefore be
directly risk-assessed. If adopting this risk-based approach then
measures need to be taken to ensure that users do not directly load the
Package Imports. It is suggested that this is handled mainly through
process, although tools could be developed to check using sessionInfo or
devtools::session_info that check the loaded packages against packages
lists of Intended for Use and Imports. In any case the use of these
tools within a standard, logged, workflow is highly recommended to
ensure traceability of the work.”</em>
</blockquote>
<p><br></p>
<p>{logrx} provides you this tool! It even goes a step further by not
just logging the packages you’ve use, but it will log use at a function
level. This gives you the flexibility of assessing the risk of functions
and approving functions, rather than having to assess the risk of the
entire package for use within your validated environment.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="how-do-i-use-this-feature">How do I use this feature?<a class="anchor" aria-label="anchor" href="#how-do-i-use-this-feature"></a>
</h2>
<div class="section level3">
<h3 id="create-a-named-list">1. Create a named list<a class="anchor" aria-label="anchor" href="#create-a-named-list"></a>
</h3>
<p>The named list contains the functions approved for use for each
package. If all functions for a package are approved for use, list
“All”.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">approved_pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  base <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  dplyr <span class="op">=</span> <span class="st">"All"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">approved_pkgs</span></span>
<span><span class="co">#&gt; $base</span></span>
<span><span class="co">#&gt; [1] "mean"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dplyr</span></span>
<span><span class="co">#&gt; [1] "All"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="build-approved-rds">2. Build <code>approved.rds</code><a class="anchor" aria-label="anchor" href="#build-approved-rds"></a>
</h3>
<p>Pass the named list through <code><a href="../reference/build_approved.html">build_approved()</a></code> to build
your tibble. We create a temp directory to save this for
illustration.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/build_approved.html">build_approved</a></span><span class="op">(</span><span class="va">approved_pkgs</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 294 × 2</span></span></span>
<span><span class="co">#&gt;    function_name         library      </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> mean                  package:base </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> slice_max             package:dplyr</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> expr                  package:dplyr</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> src                   package:dplyr</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> db_desc               package:dplyr</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> group_by_drop_default package:dplyr</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> db_commit             package:dplyr</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> coalesce              package:dplyr</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> data_frame            package:dplyr</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> summarize_if          package:dplyr</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 284 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="save-as-approved-rds">3. Save as <code>approved.rds</code><a class="anchor" aria-label="anchor" href="#save-as-approved-rds"></a>
</h3>
<p>You can use the <code>file</code> argument in
<code><a href="../reference/build_approved.html">build_approved()</a></code> to save <code>approved.rds</code> instead
of returning the tibble.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/build_approved.html">build_approved</a></span><span class="op">(</span><span class="va">approved_pkgs</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"approved.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="update-the-logrx-approved-option">4. Update the <code>logrx.approved</code> option<a class="anchor" aria-label="anchor" href="#update-the-logrx-approved-option"></a>
</h3>
<p>Update the <code>logrx.approved</code> option to point to your
<code>approved.rds</code> location. We recommend setting this in your
<code>.Rprofile</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>log.rx.approved <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"approved.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="youre-done--lets-axecute">5. You’re done. Let’s axecute!<a class="anchor" aria-label="anchor" href="#youre-done--lets-axecute"></a>
</h3>
<p><code>logrx</code> will take it from there. When each program is
executed, packages and functions will be compared to
<code>approved.rds</code> and if any unapproved use is found, it will be
logged within the “Unapproved Package and Functions” section of the log
file.</p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Let’s write a simple script summarizing mean mpg from mtcars. We save
this as <code>mpg.R</code> in the temporary directory <code>dir</code>
and <code><a href="../reference/axecute.html">axecute()</a></code> it.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Mean MPG"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">cyl</span>, values_from <span class="op">=</span> <span class="va">mean</span>, id_cols <span class="op">=</span> <span class="va">label</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   label      `4`   `6`   `8`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Mean MPG  26.7  19.7  15.1</span></span></code></pre></div>
<p>Here we have the log elements for “Used Package and Functions” and
“Unapproved Package and Functions”. We can see we used
<code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> from <code>package:base</code> and
<code>pivot_wider</code> from <code>package:tidyr</code>. We did not
include the base library or tidyr functions in our approved list, so
this has been logged!</p>
<pre><code><span><span class="co">#&gt; --------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; -                          Used Package and Functions                          -</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; {package:base} library, mean</span></span>
<span><span class="co">#&gt; {package:dplyr} %&gt;%, group_by, summarize, mutate</span></span>
<span><span class="co">#&gt; {package:tidyr} pivot_wider</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; -                       Unapproved Package and Functions                       -</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; {package:base} library</span></span>
<span><span class="co">#&gt; {package:tidyr} pivot_wider</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="a-few-words-of-caution">A Few Words of Caution<a class="anchor" aria-label="anchor" href="#a-few-words-of-caution"></a>
</h2>
<p>All packages should be attached at the top of the script to set a
consistent <code>?base::searchpaths()</code> throughout the entire
script. This will ensure the functions you use in your script are linked
to the correct package. A lint feature is available to test your scripts
follow this best practice.</p>
<p>Some functions are stored within a list, for example
<code>knitr::opts_chunck$get()</code> and
<code>knitr::opts_current$get()</code>. We do not currently identify
<code><a href="https://rdrr.io/r/base/get.html" class="external-link">get()</a></code> as a knitr function since it is not exported.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nathan Kosiba, Thomas Bermudez, Ben Straub, Michael Rimler, Nicholas Masel, Sam Parmar, GSK/Atorus JPT.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
